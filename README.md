# ❤️ Heart Disease ML — End-to-End Pipeline (UCI)

An end-to-end machine learning pipeline on the **UCI Heart Disease** dataset:
**preprocessing → PCA → feature selection → supervised & unsupervised models → hyperparameter tuning → model export → Streamlit app → optional tunneling (ngrok) → cloud deploy (Streamlit Community Cloud).**

> ⚠️ For education only — **not medical advice**.

---

## ✨ Features

- Clean data ingestion (via `ucimlrepo` or CSV) with automatic `num → target` binarization  
- Reproducible notebooks for each stage (01 → 06)  
- Baselines (**LogReg / Decision Tree / Random Forest / SVM**) + metrics & ROC  
- **Hyperparameter tuning** → exports `models/final_model.pkl`  
- **Streamlit UI** for instant predictions (uses `final_model.pkl`, falls back to `best_baseline.pkl`)  
- One-shot pipeline execution with `run_all.py`  
- Optional share via **ngrok** or deploy on **Streamlit Community Cloud**  
- Extra evaluation script saving **Confusion Matrix, ROC, PR** plots  

---

## 📁 Project Structure

```
Heart_Disease_Project/
├─ data/
│  ├─ heart_disease.csv               # (raw; optional if using ucimlrepo)
│  └─ heart_disease_clean.csv         # (generated by 01)
├─ notebooks/
│  ├─ 01_data_preprocessing.ipynb
│  ├─ 02_pca_analysis.ipynb
│  ├─ 03_feature_selection.ipynb
│  ├─ 04_supervised_learning.ipynb
│  ├─ 05_unsupervised_learning.ipynb
│  └─ 06_hyperparameter_tuning.ipynb
├─ models/
│  ├─ best_baseline.pkl               # from 04
│  └─ final_model.pkl                 # from 06 (used by the app)
├─ ui/
│  └─ app.py                          # Streamlit UI
├─ scripts/
│  └─ evaluate.py                     # saves ROC/PR/Confusion Matrix (+ report)
├─ results/                           # plots & metrics
├─ deployment/
│  └─ ngrok_setup.txt
├─ .streamlit/
│  └─ config.toml                     # optional theme
├─ run_all.py
├─ requirements.txt
├─ .gitignore
└─ README.md
```

---

## 📊 Dataset

**Recommended (cleanest):** fetch from UCI using [`ucimlrepo`](https://pypi.org/project/ucimlrepo/) (dataset ID = 45).

```python
from ucimlrepo import fetch_ucirepo
import pandas as pd

heart = fetch_ucirepo(id=45)  # Heart Disease (Cleveland subset is standard)
df = pd.concat([heart.data.features, heart.data.targets], axis=1)
df.to_csv("data/heart_disease.csv", index=False)
```

**Expected columns (Kaggle-style):**  
`age, sex, cp, trestbps, chol, fbs, restecg, thalach, exang, oldpeak, slope, ca, thal, target`

> If your raw UCI file has `num` instead of `target`, notebook **01** converts it to `target = (num > 0).astype(int)`.

---

## 🚀 Quickstart (Local)

### 1) Create a virtual environment & install deps

**Windows (PowerShell):**
```bash
python -m venv .venv
.\.venv\Scriptsctivate
pip install -r requirements.txt
pip install ucimlrepo
```

**Linux/Mac:**
```bash
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
pip install ucimlrepo
```

### 2) Get the data
- **Option A (auto)**: run **01_data_preprocessing.ipynb** (tries `ucimlrepo` first; falls back to `data/heart_disease.csv`).
- **Option B (manual)**: save CSV at `data/heart_disease.csv` using the snippet above.

### 3) Reproduce the full pipeline
```bash
python run_all.py   # executes notebooks 01 → 06 headlessly
```
Artifacts produced:
- `data/heart_disease_clean.csv`
- `results/` (EDA, PCA, ROC, metrics…)
- `models/best_baseline.pkl` (from 04)
- **`models/final_model.pkl`** (from 06; the Streamlit app uses this)

### 4) Launch the Streamlit app
```bash
streamlit run ui/app.py
```
Local URL → http://localhost:8501

**Optional (share locally via ngrok):**
```bash
ngrok config add-authtoken YOUR_AUTHTOKEN   # once
ngrok http http://127.0.0.1:8501 --host-header=localhost
```

---

## ☁️ Deploy on Streamlit Community Cloud (Recommended)

1. Push the project to **GitHub** (see steps below).  
2. Go to **streamlit.io** → **Deploy an app**.  
3. Choose your repo/branch.  
4. Set **Main file path** = `ui/app.py`.  
5. Deploy. Streamlit installs from `requirements.txt` automatically.

> ✅ If `models/final_model.pkl` is included in the repo, the app serves predictions instantly.  
> If not, the UI will warn you to train first.

---

## ⬆️ Push to GitHub

> Note: default `.gitignore` may exclude `*.pkl`. Force-add your final model so cloud runs immediately.

```bash
git init
git add .
git add -f models/final_model.pkl
git commit -m "Heart Disease ML: E2E pipeline + final model"
git branch -M main
git remote add origin https://github.com/YOUR_USERNAME/heart-disease-ml.git
git push -u origin main
```

If you have 2FA, use a **Personal Access Token** as your password on first push.

---

## 🧪 Extra Evaluation

Generate additional plots/reports after training:
```bash
python scripts/evaluate.py
```
Outputs (in `results/`):
- `confusion_matrix.png`
- `roc_full.png`
- `pr_curve.png`
- `classification_report.txt` (if enabled)

---

## 🛠️ Troubleshooting

- **`ModuleNotFoundError` (numpy/pandas/…):**  
  Run inside your venv and install deps:  
  `pip install -r requirements.txt`

- **`python: No module named jupyter` in `run_all.py`:**  
  `pip install nbconvert nbclient nbformat jupyter-core jupyter-client`

- **`OSError: cannot save file … non-existent directory`:**  
  Ensure parents exist before saving:  
  `Path(...).parent.mkdir(parents=True, exist_ok=True)`

- **Streamlit app shows “columns are missing”:**  
  The provided `ui/app.py` aligns inputs to the pipeline’s expected features automatically.

- **ngrok shows 404 / offline:**  
  Keep both terminals open; make sure ports match (`8501` by default):  
  `streamlit run ui/app.py --server.port=8501`  
  `ngrok http http://127.0.0.1:8501 --host-header=localhost`

---

## 🧰 Tech Stack

`pandas · numpy · scikit-learn · matplotlib · seaborn · xgboost · joblib · streamlit · nbconvert`

---

## 📜 License

This project is provided for educational purposes. Review dataset/source licenses before production use.
